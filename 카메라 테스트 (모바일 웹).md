ğŸ“¸ HTML + TypeScript ì¹´ë©”ë¼ í…ŒìŠ¤íŠ¸ (ëª¨ë°”ì¼ ì›¹)

**ì´ ë¬¸ì„œëŠ” ì•„ì´í°(Safari), ì•ˆë“œë¡œì´ë“œ(Chrome) ì—ì„œ ëª¨ë°”ì¼ ì›¹ë¸Œë¼ìš°ì €ë§Œìœ¼ë¡œ ì¹´ë©”ë¼ ì´¬ì˜(ë¯¸ë¦¬ë³´ê¸°/ìº¡ì²˜)ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ìµœì†Œ í…œí”Œë¦¿ì„ ì œê³µí•©ë‹ˆë‹¤.
í”„ë ˆì„ì›Œí¬ ì—†ì´ HTML + TypeScriptë§Œ ì‚¬ìš©í•˜ë©°, ë¡œì»¬ ê°œë°œ ì„œë²„ëŠ” Viteë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
í•µì‹¬ í¬ì¸íŠ¸

ì¹´ë©”ë¼ ì ‘ê·¼ì€ getUserMedia() Web APIë¡œ ìˆ˜í–‰

HTTPS ë˜ëŠ” localhostì—ì„œë§Œ ì¹´ë©”ë¼ ì ‘ê·¼ í—ˆìš©(íŠ¹íˆ iOS Safari)

ì‹¤ì œ í°ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ë™ì¼ Wi-Fi + HTTPS(ê¶Œì¥)

1) ì¤€ë¹„ë¬¼

Node.js (LTS ê¶Œì¥)

npm ë˜ëŠ” pnpm

(ì„ íƒ) ë¡œì»¬ HTTPSìš© ì¸ì¦ì„œ ìƒì„± ë„êµ¬

macOS: mkcert (ê¶Œì¥)

ë˜ëŠ” ngrok/cloudflared ê°™ì€ í„°ë„ë§

2) í”„ë¡œì íŠ¸ ìƒì„±
# ë¹ˆ í´ë”ë¥¼ ë§Œë“¤ê³  ì§„ì…
mkdir camera-web-ts && cd camera-web-ts

# Vite + TypeScript(ë°”ë‹ë¼) í…œí”Œë¦¿
npm create vite@latest . -- --template vanilla-ts

# ì˜ì¡´ì„± ì„¤ì¹˜
npm install

dã…ã…‡ã…‡ã…‡ã…‡ã…‡
í´ë” êµ¬ì¡°(ì¤‘ìš” íŒŒì¼ë§Œ):

camera-web-ts/
â”œâ”€ index.html
â”œâ”€ src/
â”‚  â””â”€ main.ts
â”œâ”€ tsconfig.json
â”œâ”€ vite.config.ts          # (ì•„ë˜ì—ì„œ ìƒì„±/ìˆ˜ì •)
â””â”€ package.json

3) HTML & TS ì½”ë“œ
index.html
<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>ëª¨ë°”ì¼ ì¹´ë©”ë¼ í…ŒìŠ¤íŠ¸</title>
    <style>
      body { margin: 0; font-family: system-ui, sans-serif; text-align: center; }
      header { padding: 12px 16px; font-weight: 700; }
      main { padding: 8px 0 24px; }
      video, canvas { width: 92vw; max-width: 480px; border: 1px solid #ddd; border-radius: 12px; }
      .controls { margin: 12px 0; display: flex; gap: 8px; justify-content: center; }
      button { padding: 10px 16px; border-radius: 10px; border: 1px solid #ccc; background: #fff; }
      .hint { color: #666; font-size: 13px; margin-top: 8px; }
    </style>
  </head>
  <body>
    <header>ğŸ“¸ HTML + TS ì¹´ë©”ë¼ í…ŒìŠ¤íŠ¸</header>
    <main>
      <video id="video" autoplay playsinline muted></video>
      <div class="controls">
        <button id="open">ì¹´ë©”ë¼ ì—´ê¸°</button>
        <button id="snap">ì‚¬ì§„ ì°ê¸°</button>
      </div>
      <canvas id="canvas" width="720" height="960"></canvas>
      <div class="controls">
        <button id="save">ì´ë¯¸ì§€ ì €ì¥</button>
      </div>
      <p class="hint">
        iOS SafariëŠ” HTTPS ë˜ëŠ” localhostì—ì„œë§Œ ì¹´ë©”ë¼ ì ‘ê·¼ì´ í—ˆìš©ë©ë‹ˆë‹¤.<br/>
        ê¶Œí•œ íŒì—…ì´ ë³´ì´ë©´ "í—ˆìš©"ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
      </p>
    </main>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>

src/main.ts
const video = document.getElementById("video") as HTMLVideoElement;
const canvas = document.getElementById("canvas") as HTMLCanvasElement;
const openBtn = document.getElementById("open") as HTMLButtonElement;
const snapBtn = document.getElementById("snap") as HTMLButtonElement;
const saveBtn = document.getElementById("save") as HTMLButtonElement;

let stream: MediaStream | null = null;

async function openCamera() {
  try {
    // í›„ë©´ì¹´ë©”ë¼ ìš°ì„ , ê¸°ê¸° ì—†ìœ¼ë©´ ë¸Œë¼ìš°ì €ê°€ ìë™ ëŒ€ì²´
    stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { ideal: "environment" } },
      audio: false,
    });
    video.srcObject = stream;
    await video.play();
  } catch (err) {
    alert("ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨: " + (err instanceof Error ? err.message : String(err)));
  }
}

function takePhoto() {
  if (!video.videoWidth || !video.videoHeight) {
    alert("ë¹„ë””ì˜¤ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
    return;
  }
  const ctx = canvas.getContext("2d");
  if (!ctx) return;

  // ë¹„ìœ¨ ë³´ì •: ìº”ë²„ìŠ¤ë¥¼ ì„¸ë¡œ ê¸°ì¤€ìœ¼ë¡œ ì‚¬ìš©
  const targetW = canvas.width;
  const targetH = canvas.height;

  // ì¤‘ì•™ í¬ë¡­(ê°„ë‹¨í•œ ì˜ˆì‹œ)
  const vw = video.videoWidth;
  const vh = video.videoHeight;
  const vAspect = vw / vh;
  const cAspect = targetW / targetH;

  let sx = 0, sy = 0, sw = vw, sh = vh;
  if (vAspect > cAspect) {
    // ê°€ë¡œê°€ ë” ë„“ìœ¼ë©´ ì¢Œìš° í¬ë¡­
    sw = Math.floor(vh * cAspect);
    sx = Math.floor((vw - sw) / 2);
  } else if (vAspect < cAspect) {
    // ì„¸ë¡œê°€ ë” ê¸¸ë©´ ìƒí•˜ í¬ë¡­
    sh = Math.floor(vw / cAspect);
    sy = Math.floor((vh - sh) / 2);
  }

  ctx.drawImage(video, sx, sy, sw, sh, 0, 0, targetW, targetH);
}

function saveImage() {
  canvas.toBlob((blob) => {
    if (!blob) return;
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `photo_${Date.now()}.jpg`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }, "image/jpeg", 0.9);
}

openBtn.addEventListener("click", openCamera);
snapBtn.addEventListener("click", takePhoto);
saveBtn.addEventListener("click", saveImage);

// iOS ì¼ë¶€ í™˜ê²½ì—ì„œ ìë™ ì¹´ë©”ë¼ ì˜¤í”ˆì´ ì œí•œë˜ë¯€ë¡œ ë²„íŠ¼ìœ¼ë¡œ ì—¬ëŠ” ë°©ì‹ì„ ê¸°ë³¸ ì œê³µ

4) Vite ê°œë°œ ì„œë²„ ì„¤ì •

ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œ ì ‘ê·¼í•˜ë ¤ë©´ LANìœ¼ë¡œ ë°”ì¸ë”©í•´ì•¼ í•©ë‹ˆë‹¤. vite.config.tsë¥¼ ìƒì„±/ìˆ˜ì •í•˜ì„¸ìš”.

ê°„ë‹¨ LAN ê³µê°œ(HTTP)
// vite.config.ts
import { defineConfig } from "vite";

export default defineConfig({
  server: {
    host: true,       // 0.0.0.0 ë°”ì¸ë”© (ë™ì¼ Wi-Fi ê¸°ê¸° ì ‘ê·¼ í—ˆìš©)
    port: 5173
  }
});


ì´ ìƒíƒœë¡œëŠ” HTTPì´ë¯€ë¡œ Android Chromeì€ ë³´í†µ ë™ì‘í•˜ì§€ë§Œ,
iOS SafariëŠ” ì¹´ë©”ë¼ ì ‘ê·¼ì„ ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì›ê²© HTTP).
=> ì•„ë˜ HTTPS ì„¤ì •ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

ë¡œì»¬ HTTPS (ê¶Œì¥, iOS Friendly)

ë¡œì»¬ ì‹ ë¢° ì¸ì¦ì„œ ìƒì„±(ì˜ˆ: macOS)

brew install mkcert nss   # (Homebrew)
mkcert -install
mkcert localhost
# => localhost.pem, localhost-key.pem ìƒì„±


Viteì— HTTPS ì ìš©

// vite.config.ts
import { defineConfig } from "vite";
import fs from "fs";

export default defineConfig({
  server: {
    host: true,
    port: 5173,
    https: {
      key: fs.readFileSync("./localhost-key.pem"),
      cert: fs.readFileSync("./localhost.pem"),
    },
  },
});


âš ï¸ iPhoneì—ì„œ ì ‘ì† ì‹œ, â€œì‹ ë¢°ë˜ì§€ ì•Šì€ ì¸ì¦ì„œâ€ ê²½ê³ ê°€ ëœ° ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê°œë°œìš©ì´ë¯€ë¡œ ì¼ì‹œì ìœ¼ë¡œ ì‹ ë¢° ì„¤ì • í›„ ì§„í–‰í•˜ì„¸ìš”.

ëŒ€ì•ˆ: í„°ë„ë§ ì‚¬ìš©(ì„¤ì • ê°„ë‹¨)
# í„°ë„ ì—´ê¸° (ë¡œì»¬ 5173 â†’ í¼ë¸”ë¦­ HTTPS)
npx ngrok http 5173
# ì¶œë ¥ë˜ëŠ” https URLì„ iPhone/Androidì—ì„œ ì—´ê¸°

5) ì‹¤í–‰ & ëª¨ë°”ì¼ì—ì„œ í…ŒìŠ¤íŠ¸
npm run dev


ì½˜ì†”ì— ì¶œë ¥ë˜ëŠ” URL ì˜ˆì‹œ:

  Local:   https://localhost:5173/
  Network: https://192.168.0.12:5173/     # í°ì—ì„œ ì´ ì£¼ì†Œ ì˜¤í”ˆ


ë™ì¼ Wi-Fiì— ì—°ê²°ëœ iPhone/Androidì—ì„œ Network ì£¼ì†Œë¥¼ ì—½ë‹ˆë‹¤.

iOS Safari: HTTPS ê¶Œì¥(ë˜ëŠ” ngrok HTTPS ì£¼ì†Œ ì´ìš©).

í˜ì´ì§€ê°€ ëœ¨ë©´ [ì¹´ë©”ë¼ ì—´ê¸°] ë²„íŠ¼ â†’ ê¶Œí•œ í—ˆìš© â†’ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ

[ì‚¬ì§„ ì°ê¸°] â†’ ìº”ë²„ìŠ¤ì— í•œ í”„ë ˆì„ ìº¡ì²˜

[ì´ë¯¸ì§€ ì €ì¥] â†’ ê¸°ê¸°ë¡œ JPG ë‹¤ìš´ë¡œë“œ